[command]
name = "neo:cd-app-service"
prefix = "neo-cicd"
description = "Automatically configure Azure App Service deployment process (CD) for the project"

[[parameters]]
name = "app_name"
description = "Name of the Azure App Service"
required = true

[[parameters]]
name = "env"
description = "Deployment environment name (e.g., dev, staging, prod)"
required = true
default = "dev"

[implementation]
steps = [
    "1. Create Target Directory: Ensure `.azure-pipelines/` folder exists in the project root.",
    "2. Copy Templates: Copy all contents from `skills/azure-pipelines/templates/` to `.azure-pipelines/`.",
    "3. Generate CD File: Create `cd-[app_name]-[env].yml` in the project root.",
    "4. Write Content: Content should use Multi-stage architecture and reference `.azure-pipelines/deploy/deploy-app-service.yml`.",
    "5. Default Content Template:",
    "```yaml",
    "trigger: none # CD is usually triggered by a pipeline or manually",
    "",
    "resources:",
    "  pipelines:",
    "    - pipeline: build-pipeline",
    "      source: 'CI-Pipeline-Name'",
    "      trigger: true",
    "",
    "stages:",
    "  - stage: Deploy",
    "    displayName: 'Deploy to ${{ parameters.env }}'",
    "    jobs:",
    "      - job: DeployJob",
    "        pool:",
    "          vmImage: 'ubuntu-latest'",
    "        steps:",
    "          - template: .azure-pipelines/deploy/deploy-app-service.yml",
    "            parameters:",
    "              azureSubscription: 'Your-Service-Connection'",
    "              webAppName: '${{ parameters.app_name }}'",
    "              resourceGroupName: 'Your-Resource-Group'",
    "              slotName: 'production'",
    "```"
]

[constraints]
rules = [
    "Must include resources/pipelines definition to retrieve Artifacts from the CI pipeline.",
    "Must correctly pass key parameters like azureSubscription.",
    "Ensure the directory structure is complete after copying."
]