[command]
name = "neo:cd-iis"
prefix = "neo-cicd"
description = "Automatically configure On-Premises IIS deployment process (CD) for the project"

[[parameters]]
name = "website_name"
description = "Website name in IIS"
required = true

[[parameters]]
name = "physical_path"
description = "Physical path on the server (e.g., C:\inetpub\wwwroot\myapp)"
required = true

[[parameters]]
name = "env"
description = "Deployment environment name (e.g., dev, staging, prod)"
required = true
default = "dev"

[implementation]
steps = [
    "1. Create Target Directory: Ensure `.azure-pipelines/` folder exists in the project root.",
    "2. Copy Templates: Copy all contents from `skills/azure-pipelines/templates/` to `.azure-pipelines/`.",
    "3. Generate CD File: Create `cd-iis-[website_name]-[env].yml` in the project root.",
    "4. Write Content: Content should use Deployment Job and reference `.azure-pipelines/deploy/deploy-iis.yml`.",
    "5. Default Content Template:",
    "```yaml",
    "trigger: none",
    "",
    "resources:",
    "  pipelines:",
    "    - pipeline: build-pipeline",
    "      source: 'CI-Pipeline-Name'",
    "      trigger: true",
    "",
    "stages:",
    "  - stage: Deploy",
    "    displayName: 'Deploy to IIS'",
    "    jobs:",
    "      - deployment: IISDeploy",
    "        environment: '${{ parameters.env }}-iis-group' # Corresponds to Azure DevOps Environment",
    "        strategy:",
    "          runOnce:",
    "            deploy:",
    "              steps:",
    "                - template: .azure-pipelines/deploy/deploy-iis.yml",
    "                  parameters:",
    "                    websiteName: '${{ parameters.website_name }}'",
    "                    websitePhysicalPath: '${{ parameters.physical_path }}'",
    "                    appPoolName: '${{ parameters.website_name }}'",
    "                    backupPath: 'C:\\Backup\\${{ parameters.website_name }}'",
    "```"
]

[constraints]
rules = [
    "Must use Deployment Job with the environment property to execute on on-premises servers.",
    "websitePhysicalPath should use double backslashes or raw strings for paths.",
    "Recommended to include backupPath setting by default."
]